<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- <link rel="stylesheet" href="style.css"> -->
    <script src="https://demos.jquerymobile.com/1.4.2/js/jquery.js"></script>

    <!-- Latex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.9/katex.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.9/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.9/contrib/auto-render.min.js"></script>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://unpkg.com/mathjs/lib/browser/math.js"></script>
    <title>Calculateur PE</title>
    <style>
        :root {
            --first-color: #333F50;
            --second-color: #FFF1E5;
            --third-color: #AE7451;
            --grey-light: #eeee;
        }

        body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            font-family: "Constantia", sans-serif;
            font-size: 62.5%;
        }

        p {
            font-size: 1.1rem;
        }

        .hightlight {
            color: var(--third-color);
            font-weight: bold;
        }

        .formular {
            font-size: 1rem;
            font-weight: bold;
            padding: 1rem 0rem;
        }

        .takeholder {
            width: 8rem;
        }

        .w-5 {
            width: 5rem;
        }

        .w-3 {
            width: 3rem;
        }

        .form-select {
            border: none;
            border-bottom: 1px solid #e8eaeb;
        }

        .header {
            padding-top: 0px;
            height: 100px;
            width: 100%;
            background-color: var(--first-color);
            color: #ffffff;
            display: flex;
        }

        .title {
            font-size: 2rem;
            font-weight: 300;
            padding-left: 25px;
            align-self: center;
        }

        .make-me-sticky {
            position: -webkit-sticky !important;
            position: sticky;
            top: 0;
            z-index: 9;
        }

        /* Nav tab */

        .nav-tab {
            display: flex;
            flex-direction: column;
            text-align: center;
            background: white;
            height: 100vh;
        }

        .tab {
            float: left;
            width: 100%;
            text-align: center;
        }

        .nav-tab a {
            font-size: 1.5rem;
            cursor: pointer;
            transition: 0.3s;
            padding: 1rem;
            color: lightgrey;
            text-align: center;
        }

        .nav-tab a:hover {
            transform: scale(1.1) !important;
            color: black;
        }

        .nav-tab .active {
            color: black;
            pointer-events: none;
        }

        .nav-tab .nav-tabs {
            border-bottom: none;
            padding: 0rem;
        }

        .nav-tab .nav-tabs .nav-link {
            border: none;
            font-weight: bold;
        }

        .nav-tab .nav-tabs .nav-item {
            width: 100%;

            text-align: start;
        }

        .nav-tab .nav-tabs .nav-item .active {
            background: rgb(250, 250, 250);
        }

        .nav-tabs {
            padding: 1rem;
            border: none;
        }

        .nav-tabs button {
            font-size: 1rem;
            color: black;
            padding: 0rem 1rem;
            width: fit-content;
            font-weight: bold;
        }

        .nav-tabs button:hover {
            border: none;
            color: black;
        }

        .nav-tabs button.active {
            border: none;
            border-radius: 1.5rem;
            background-color: var(--third-color) !important;
            color: white !important;
        }

        .title-mark {
            width: 0.3rem;
            height: 2rem;
            margin-right: 1rem;
            background: var(--third-color);
        }

        .col-form-label {
            width: fit-content;
            font-size: 1rem;
            background-color: var(--third-color);
            color: white;
            padding: 5px 10px;
            border-top-right-radius: 1rem;
            border-bottom-left-radius: 1rem;
        }

        .icons {
            font-size: 1rem;
        }

        table td,
        th {
            font-size: 1rem;
        }

        .table tbody th {
            font-size: 1rem;
            border: none;
            text-align: center;
            color: var(--third-color);
            font-weight: bold;
            border-bottom: 1px solid var(--third-color);
            padding: 0;
            width: max-content;
        }

        .table tbody td {
            font-size: 1rem;
            border: none;
            text-align: center;
            font-weight: bold;
            padding: 0;
        }

        .table thead tr:first-child {
            border-bottom: 1px solid var(--third-color);
        }

        .table-cashflow {
            table-layout: fixed;
        }

        .table-cashflow tbody tr:first-child {
            border-bottom: 1px solid var(--third-color);
        }

        .table-cashflow tbody td:first-child {
            background-color: var(--third-color);
            color: white;
            font-weight: bold;
            width: 8rem;
            border-bottom: 1px solid var(--second-color);
        }

        .table-irr tbody tr td {
            width: 8rem;
            background-color: var(--first-color);

        }

        .mom-input {
            font-size: 0.8rem;
        }

        .table-mom tbody tr td,
        .table-aggregated tbody tr td {
            text-align: right;
            table-layout: fixed;
            font-size: 0.8rem;
            background-color: var(--third-color);
            color: white;
            border-bottom: 1px solid var(--second-color);
            border-right: 1px solid var(--second-color);
            padding: 0 0.5rem;
        }

        .table-mom tbody tr td:first-child,
        .table-aggregated tbody tr td:first-child,
        .table-mom tbody tr td:nth-child(3) {
            text-align: left;
        }

        .table-mom tbody tr td:nth-child(2) {
            padding: 0;
            width: 5rem;
        }

        .table-mom tbody tr:nth-child(2) td {
            /* padding: 0 0.5rem; */
            /* font-size: 1rem; */
        }

        .table-mom tbody tr:nth-child(3) td {
            /* padding: 0 0.5rem; */
            /* font-size: 1rem; */
        }

        .table-result td {
            table-layout: fixed;
            width: 150px;
        }

        .card {
            border: none;
            border-radius: 1rem;
            box-shadow: 0 16px 50px rgb(233, 219, 211);
        }

        .card-body {
            padding: 2rem 2rem;
        }

        .card-notice {
            padding: 3rem 2rem 2rem 3rem;
            border-radius: 0 1rem 0 1rem;
            background-color: var(--first-color);
            color: #ffffff;
            position: relative;
        }

        .ampoule {
            position: absolute;
            width: 5rem;
            top: -40px;
            left: 1px;
            animation: waitForClick 2s infinite;
        }

        @import url('https://fonts.googleapis.com/css?family=Roboto+Condensed');

        /* 
  reset the list elements first (normalize)
*/

        ul,
        li {
            margin: 0;
            padding: 0;

        }

        span::first-letter {
            text-transform: capitalize;
        }

        body {
            font-family: 'Roboto Condensed', serif;
        }

        main {
            height: 100%;
            display: grid;
        }

        input {
            width: 100%;
            border: none;
            border-bottom: 1px solid #e8eaeb;
            font-size: 1rem;
            text-align: center;
        }

        input[type=range] {
            border: none;
            width: 100%;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            background-color: var(--first-color);
        }

        input[type=range].inflow::-webkit-slider-thumb {
            background-color: #C00000;
        }

        input[type=range].outflow::-webkit-slider-thumb {
            background-color: #578537;
        }

        .inflow-color {
            font-weight: bold;
            color: #C00000;
        }

        .outflow-color {
            color: #578537;
            font-weight: bold;

        }

        section {
            padding: 2rem;
        }

        .label {
            font-size: 1rem;
        }

        .marron-label {
            font-size: 1rem;
            color: var(--third-color);
            margin: 0;
            font-weight: bold;
        }

        .btn-normal {
            padding: 0.5rem 1rem;
            background-color: var(--third-color);
            color: white;
            width: fit-content;
            position: absolute;
            right: 3rem;
            bottom: -1rem;
            animation: waitForClick 2s infinite;
        }

        .btn-normal:hover {
            transform: scale(1.015);
            background-color: #af6536;
            color: white;
        }

        .highcharts-figure,
        .highcharts-data-table table {
            min-width: 310px;
            max-width: 850px;
            margin: 1em auto;
        }

        .highcharts-data-table table {
            font-family: Verdana, sans-serif;
            border-collapse: collapse;
            border: 1px solid #ebebeb;
            margin: 10px auto;
            text-align: center;
            width: 100%;
            max-width: 500px;
        }

        .highcharts-data-table caption {
            padding: 1em 0;
            font-size: 1.2em;
            color: #555;
        }

        .highcharts-data-table th {
            font-weight: 600;
            padding: 0.5em;
        }

        .highcharts-data-table td,
        .highcharts-data-table th,
        .highcharts-data-table caption {
            padding: 0.5em;
        }

        .highcharts-data-table thead tr,
        .highcharts-data-table tr:nth-child(even) {
            background: #f8f8f8;
        }

        .highcharts-data-table tr:hover {
            background: #f1f7ff;
        }

        .carousel-item {
            transition: transform 0.08s ease;
        }

        .startBtn {
            position: absolute;
            bottom: 2px;
            right: 580px;
            width: 100px;
            height: 40px;
            z-index: 1;
            background-color: var(--third-color);
            font-size: 1.2rem;
            color: var(--second-color);
            border-radius: 5px;
            border: 4px outset rgba(174, 117, 81, 0.432);
            border-radius: 15px;
            margin: auto;
            line-height: 1.25rem;
            padding: 0px;
            animation: waitForClick 5s infinite;
        }

        figure {
            margin: 0;
        }

        @keyframes waitForClick {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        .startBtn:hover {
            transform: scale(1.015);
            background-color: #af6536;
        }

        @media screen and (max-width: 1800px) {
            .formular {
                font-size: 0.7rem !important;
                font-weight: bold;
                padding: 0rem;
            }
        }

        @media screen and (max-width: 700px) {
            .box {
                width: 70%;
            }

            .popup {
                width: 70%;
            }
        }

        .carousel-image {
            width: 100%;
        }

        .katex-html {
            padding: 10px 0 10px 0;
        }

        .explanation {
            background-color: #FFF1E5;
            color: var(--first-color);
            font-size: 1.2rem;
        }

        .explanation:hover {
            background-color: #ffdfc4;
        }
    </style>
</head>

<body>
    <header>
        <div class="header">
            <h1 class="title">Private Equity - Performance Measurement</h1>
        </div>
    </header>
    <main class="d-flex">
        <div class="row" style="width:100%">
            <div class="col-1" style="width: 12%;">
                <div class="nav-tab make-me-sticky">
                    <ul class="nav nav-tabs">
                        <li class="nav-item">
                            <a class="nav-link active" id="introduce-tab" data-bs-toggle="tab" href="#introduce" role="tab" aria-controls="introduce" aria-selected="true">Introduction</a>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link" id="simulation-tab" data-bs-toggle="tab" href="#simulation" role="tab" aria-controls="simulation" aria-selected="false">Simulation</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-10" style="width: 88%;">
                <div class="tab-content">
                    <div class="tab-pane fade show active" role="tabpanel" id="introduce">
                        <!-- Hippo -->
                        <div id="carouselExampleControls" class="carousel slide carousel-fade" data-bs-ride="carousel" data-interval="false">
                            <div class="carousel-inner" id="introductionCarousel" style="margin-bottom: 0px;">
                            </div>
                            <script>
                                elements = ''
                                for (let i = 1; i <= 27; i++) {
                                    if (i == 1) {
                                        elements += `
                      <div class="carousel-item active">
                          <img src="images/Image ${i}.jpg" class="carousel-image d-block" alt="...">
                      </div>
                      `
                                    } else if (i == 27) {
                                        elements += `
                      <div class="carousel-item" style="position: relative;">
                          <img src="images/Image ${i}.jpg" class="carousel-image d-block" alt="...">
                          <button class="startBtn" id="goToSimulation" type="button">Start</button>
                      </div>
                      `
                                    } else {
                                        elements += `
                    <div class="carousel-item">
                        <img src="images/Image ${i}.jpg" class="carousel-image d-block" alt="...">
                    </div>
                    `
                                    }
                                }

                                const carousel = document.getElementById('introductionCarousel')
                                carousel.innerHTML = elements;
                                document.getElementById('goToSimulation').addEventListener('click', function () {
                                    document.getElementById('simulation-tab').click()
                                })
                            </script>
                            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true" style="background-color: var(--first-color);"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                                <span class="carousel-control-next-icon" style="background-color: var(--first-color);" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>

                        <!-- Hippo -->
                    </div>
                    <div class="tab-pane fade " role="tabpanel" id="simulation">
                        <nav>
                            <div class="nav nav-tabs d-flex justify-content-evenly " id="nav-tab" role="tablist">
                                <button class="nav-link active" id="nav-case-study-tab" data-bs-toggle="tab" data-bs-target="#nav-case-study" type="button" role="tab" aria-controls="nav-case-study" aria-selected="true">Case study</button>
                                <button class="nav-link" id="nav-invest-horizon-tab" data-bs-toggle="tab" data-bs-target="#nav-invest-horizon" type="button" role="tab" aria-controls="nav-invest-horizon" aria-selected="false">Investment horizon impact on IRR</button>
                                <button class="nav-link" id="nav-cash-flow-tab" data-bs-toggle="tab" data-bs-target="#nav-cash-flow" type="button" role="tab" aria-controls="nav-cash-flow" aria-selected="false">Cash Flow distribution
                                    impact on IRR</button>
                                <button class="nav-link" id="nav-performance-tab" data-bs-toggle="tab" data-bs-target="#nav-performance" type="button" role="tab" aria-controls="nav-performance" aria-selected="false">PE Performance
                                    Calculation
                                </button>
                                <button class="nav-link " id="nav-portfolio-tab" data-bs-toggle="tab" data-bs-target="#nav-portfolio" type="button" role="tab" aria-controls="nav-portfolio" aria-selected="false">Portfolio IRR analyse
                                </button>
                            </div>
                        </nav>
                        <div class="tab-content" id="nav-tabContent">
                            <div class="tab-pane fade show active" id="nav-case-study" role="tabpanel" aria-labelledby="nav-case-study-tab">

                                <section>
                                    <div class="card">
                                        <div class="card-body">

                                            <p>Let’s suppose you are a senior associate in one private equity firm, in charge of investment
                                                opportunities analysis.
                                            </p>
                                            <br>
                                            <p>
                                                One opportunity captures your attention. Here are some key data points to quickly identify
                                                whether or not this opportunity is worth pursuing :
                                            </p>
                                            <p class="hightlight">Fund Size (M€) : <span>100</span>
                                            </p>
                                            <p class="hightlight">Term (Years) : <span>8</span>
                                            </p>
                                            <p class="hightlight">Multiple of Money invested (MoM) : <span>1.5</span>
                                            </p>
                                            <br>
                                            <p>
                                                For illustration purposes, the timing of investments and distributions are spaced out equally.
                                            </p>

                                            <br>
                                            <p>
                                                What’s the IRR of this investment opportunity?
                                            </p>
                                            <div class="row justify-content-center">
                                                <button class="btn btn-normal" id="show-analysis">Show Performance Analysis
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <br>
                                    <br>
                                    <div class="card card-notice explanation d-none" id="irr-explanation">
                                        <img src="/images/ampoule.png" alt="" class="ampoule">
                                        <h5><b>But what exactly is the IRR?</b> </h5>
                                        <ul>
                                            <li>The Internal Rate of Return (IRR) is the discount rates that makes the
                                                present value of the expected cash distribution equal to the inital cost of the project. The
                                                higher
                                                the IRR the better the return of an investment.</li>
                                            <div class="formular">\(\mathbf{NPV = 0 = CF_{0} +
                                                \frac{CF_{1}}{(1+IRR)^{1}} + \frac{CF_{2}}{(1+IRR)^{2}} + ... + \frac{CF_{n}}{(1+IRR)^{n}} =
                                                \sum_{t=0}^{n}\frac{CF_{t}}{(1+IRR)^{t}}}\)</div>

                                            <li>It is the discount rate that makes the present value of a project’s estimated cash inflows
                                                equal to the present value of the project’s estimated cash outflows.</li>
                                            <div class="formular">\(\mathbf{Present\, Value_{Inflows} = Present\,
                                                Value_{Outflows}}\)</div>
                                        </ul>
                                    </div>
                                    <br>
                                    <br>
                                    <div class="card d-none" id="performance-analysis">
                                        <div class="card-body">
                                            <div class="row">
                                                <h5><b><svg class="title-mark"></svg>Distribution of Cash Flow (M€)</b>
                                                </h5>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <table class="table table-cashflow" id="investTable1">
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1 takeholder">

                                                </div>
                                                <div class="col">
                                                    <figure>
                                                        <div id="container"></div>
                                                    </figure>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <h5><b><svg class="title-mark"></svg>Result</b>
                                                </h5>
                                            </div>
                                            <div class="row">
                                                <div id="metrics">
                                                    <table class="table table-result" id="result-table1">
                                                    </table>
                                                </div>
                                                <div class="col-9">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <br><br>
                                    <br><br>
                                    <div class="card card-notice d-none" id="question-next">
                                        <img src="/images/ampoule.png" alt="" class="ampoule">
                                        <span id="equation-values" style="font-size: 1rem"></span>
                                        <br>
                                        <div class="row ">
                                            <h5>How would be the impact on IRR if we change the Investment Horizon?</h5>
                                        </div>
                                        <button class="btn btn-normal" id="btn-next1">Next - Investment horizon impact on IRR</button>

                                    </div>
                                </section>
                            </div>
                            <div class="tab-pane fade" id="nav-invest-horizon" role="tabpanel" aria-labelledby="nav-invest-horizon-tab">
                                <section>
                                    <div class="card card-notice explanation">
                                        <img src="/images/ampoule.png" alt="" class="ampoule">
                                        <h5><b>How does the investment horizon affect the IRR ? </b> </h5>
                                        <p>Generally speaking, the Internal Rate of Return is very sensitive to the investment horizon
                                            (holding everything else constant) :
                                        </p>
                                        <ul>
                                            <li>With <b>longer</b> investment horizon, IRR tends to be <b>smaller</b>.
                                            </li>
                                            <li>With <b>shorter</b> investment horizon, IRR tends to be <b>greater</b>.
                                            </li>
                                        </ul>
                                        <br>
                                        <p>
                                            The intuitition behind this is that as time passes, the Present Value will tend to decrease. Thus,
                                            IRR is maximized with short investment horizon.
                                        </p>
                                    </div>
                                    <br><br>
                                    <div class="card" id="">
                                        <div class="card-body">
                                            <div class="row">
                                                <h5><b>Please change your investment horizon below to see the impact of IRR:
                                                    </b>
                                                </h5>
                                            </div>
                                            <div class="row align-items-center">
                                                <div class="col-auto">
                                                    <label for="years" class="col-form-label">Investment horizon (years) </label>
                                                </div>
                                                <div class="col-auto" style="width: 40%;">
                                                    <input type="range" class="form-range" min="4" max="12" step="2" id="years" value="8">
                                                </div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <p class="marron-label"><span id="show-years">8</span> Years</p>
                                                </div>
                                            </div>
                                            <br>
                                            <br>
                                            <div class="row">
                                                <h5><b><svg class="title-mark"></svg>Distribution of Cash Flow (M€)</b>
                                                </h5>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <table class="table table-cashflow" id="investTable2">
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1 takeholder">
                                                    <table class="table table-cashflow table-irr">
                                                        <tbody>
                                                            <tr>
                                                                <td>IRR</td>
                                                            </tr>
                                                            <tr>
                                                                <td><span id="irr1"></span> %</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="col">
                                                    <figure>
                                                        <div id="container2"></div>
                                                    </figure>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <h5><b><svg class="title-mark"></svg>Result</b>
                                                </h5>
                                            </div>
                                            <div class="row">
                                                <div>
                                                    <table class="table table-result" id="result-table2">
                                                    </table>
                                                </div>
                                                <div class="col-9">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <br><br>
                                    <div class="card card-notice">
                                        <img src="/images/ampoule.png" alt="" class="ampoule">
                                        <div class="row ">
                                            <h5>You’ve seen the impact of time on IRR but what about the Cash Flow distribution ?
                                            </h5>
                                        </div>
                                        <button class="btn btn-normal" id="btn-next2">Next - Cash Flow distribution impact on IRR</button>
                                    </div>
                                </section>

                            </div>
                            <div class="tab-pane fade" id="nav-cash-flow" role="tabpanel" aria-labelledby="nav-cash-flow-tab">
                                <section>
                                    <div class="card card-notice explanation">
                                        <img src="/images/ampoule.png" alt="" class="ampoule">
                                        <h5><b>How does Cash Flow timing affect the IRR ?</b> </h5>
                                        <p>The Internal Rate of Return is highly dependent on the timing of cash flows, both received and
                                            paid (holding everything else constant):
                                        </p>
                                        <ul>
                                            <li><span class="inflow-color">Capital Calls </span>that are received early tend to
                                                <b>decrease</b> the IRR.
                                            </li>
                                            <li><span class="inflow-color">Capital Calls </span>that are received late tend to
                                                <b>increase</b> the IRR.
                                            </li>
                                            <br>
                                            <li><span class="outflow-color">Distribution </span>that are received early tend to
                                                <b>increase</b> the IRR.
                                            </li>
                                            <li><span class="outflow-color">Distribution </span>that are received late tend to
                                                <b>decrease</b> the IRR.
                                            </li>
                                        </ul>
                                        <br>
                                        <p>The intuitition behind this is that as the duration of deployed cash increases, the Present Value
                                            will be smaller and smaller.
                                            Thus, IRR is maximized with late capital calls and early cash distributions.
                                        </p>
                                    </div>
                                    <br><br>
                                    <div class="card" id="">
                                        <div class="card-body">
                                            <div class="row g-3 align-items-center justify-content-between">
                                                <div class="col-auto">
                                                    <label for="years" class="col-form-label">Cash Flow Distribution</label>
                                                </div>
                                                <div class="col">
                                                    <div class="d-flex flex-row justify-content-center">
                                                        <label for="inflow" class="inflow-color label">Capital Calls</label>
                                                    </div>
                                                    <input type="range" class="form-range inflow" min="1" max="15" step="1" id="inflow" value="8">
                                                    <div class="d-flex flex-row justify-content-between">
                                                        <i class="bi bi-dash-circle icons"></i>
                                                        <span class="icons">Concentration</span>
                                                        <i class="bi bi-plus-circle  icons"></i>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="d-flex flex-row justify-content-center">
                                                        <label for="outflow" class="outflow-color label">Distribution</label>
                                                    </div>
                                                    <input type="range" class="form-range outflow" min="1" max="15" step="1" id="outflow" value="8">
                                                    <div class="d-flex flex-row justify-content-between">
                                                        <i class="bi bi-dash-circle icons"></i>
                                                        <span class="icons">Concentration</span>
                                                        <i class="bi bi-plus-circle  icons"></i>
                                                    </div>
                                                </div>
                                            </div>
                                            <br><br>
                                            <br><br>
                                            <div class="row">
                                                <h5><b><svg class="title-mark"></svg>Distribution of Cash Flow (M€)</b>
                                                </h5>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <table class="table table-cashflow" id="investTable3">
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1 takeholder">
                                                    <table class="table table-cashflow table-irr" id="">
                                                        <tbody>
                                                            <tr>
                                                                <td>IRR</td>
                                                            </tr>
                                                            <tr>
                                                                <td><span id="irr2"></span> %</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="col">
                                                    <figure>
                                                        <div id="container3"></div>
                                                    </figure>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <h5><b><svg class="title-mark"></svg>Result</b>
                                                </h5>
                                            </div>
                                            <div class="row">
                                                <div>
                                                    <table class="table table-result" id="result-table3">
                                                    </table>
                                                </div>
                                                <div class="col-9">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <br><br>
                                    <div class="card card-notice">
                                        <img src="/images/ampoule.png" alt="" class="ampoule">
                                        <div class="row ">
                                            <h5>At this point you’ve seen the impact of both time and Cash Flow distribution on IRR. Well done
                                                !
                                            </h5>
                                            <h5>Now it’s your turn, try to test with the parameters you want and see how the IRR would respond
                                                !
                                            </h5>
                                        </div>
                                        <button class="btn btn-normal" id="btn-next3">Next - PE Performance Calculation</button>
                                    </div>
                                </section>
                            </div>
                            <div class="tab-pane fade" id="nav-performance" role="tabpanel" aria-labelledby="nav-performance-tab">
                                <section>
                                    <div class="card card-notice explanation">
                                        <img src="/images/ampoule.png" alt="" class="ampoule">
                                        <h5><b>Your turn ! </b> </h5>
                                        <p>Now you have the main intuition behind the IRR. In this section, you can evaluate one PE
                                            investment opportunity based on specific investment horizons and Cash Flow distributions.
                                        </p>
                                        <ul>
                                            <p>Just remember:</p>
                                            <li>If you are <u>considering a potential project</u> for which you know in advance the investment
                                                period and the Cash Flow pattern, the IRR corresponds to your minimum required rate of return
                                                for you to invest in the project.
                                            </li>
                                            <li>If you are <u>evaluating the performance of an existing portfolio</u>.The Portfolio IRR shows
                                                the annualised performance of an investor’s entire portfolio based on the investments’ current
                                                value.
                                            </li>
                                        </ul>
                                    </div>
                                    <br><br>
                                    <div class="card" id="">
                                        <div class="card-body">
                                            <br><br>
                                            <div class="row">
                                                <div class="col-auto"><label for="time-horizon" class="col-form-label">Investment
                                                        horizon</label>
                                                </div>
                                                <div class="col-auto" style="width:15rem"><input type="number" min="2" max="20" class="" id="time-horizon" placeholder="Enter year"></div>
                                                <div class="col-auto d-flex align-items-center">
                                                    <label for="" class="marron-label">years
                                                    </label>
                                                </div>
                                            </div>
                                            <br><br>
                                            <div class="row">
                                                <h5><b><svg class="title-mark"></svg>Distribution of Cash Flow (M€) </b><span class="marron-label">(Please enter capital calls as negative)</span>
                                                </h5>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <table class="table table-cashflow" id="investTable4">
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1 takeholder">
                                                    <table class="table table-cashflow table-irr" id="">
                                                        <tbody>
                                                            <tr>
                                                                <td>IRR</td>
                                                            </tr>
                                                            <tr>
                                                                <td><span id="irr3"></span> %</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="col">
                                                    <figure>
                                                        <div id="container4"></div>
                                                    </figure>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <h5><b><svg class="title-mark"></svg>Result</b>
                                                </h5>
                                            </div>
                                            <div class="row">
                                                <div>
                                                    <table class="table table-result" id="result-table4">
                                                    </table>
                                                </div>
                                                <div class="col-9">
                                                </div>
                                            </div>
                                        </div>
                                        <button class="btn btn-normal" id="btn-next4">Next - Portfolio IRR analyse</button>
                                    </div>
                                </section>
                            </div>
                            <div class="tab-pane fade" id="nav-portfolio" role="tabpanel" aria-labelledby="nav-portfolio-tab">
                                <section>
                                    <div class="card card-notice explanation">
                                        <img src="/images/ampoule.png" alt="" class="ampoule">
                                        <h5><b>After exploring IRR calculation for single investment, let’s now have a close look at how to
                                                calculate IRR for multiple projects. </b> </h5>
                                        <p>Suppose 300M is invested equally in 3 Private Equity Projects. (100M each)
                                        </p>
                                        <ul>
                                            <p>You have the possibility to create project by modifying Multiple of Money (MoM) and ajusting
                                                Cash Flow Distribution. Recall that the MoM is the ratio of the cash generated divided by the
                                                cash invested. For exemple, 100$ investment that generates 200$ will have a MoM of 2:</p>
                                            <li>A project that generates profit will have a MoM &gt; 1
                                            </li>
                                            <li>A project that generates losses will have a MoM &lt; 1 </li>
                                            <br>
                                            <p>For illustration purposes, we’ll assume the 3rd project to have a MoM of 0.9. Notice that
                                                the fund exhibits a negative IRR. In general a negative IRR is an indication that an
                                                investment generates losses.</p>
                                        </ul>
                                    </div>
                                    <br><br>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="card" id="">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <h5><b><svg class="title-mark"></svg>Project Cash Flow</b>
                                                        </h5>
                                                    </div>

                                                    <div class="row">
                                                        <p><b>Project 1</b></p>
                                                        <div class="row">
                                                            <table class="table table-mom">
                                                                <tbody>
                                                                    <tr>
                                                                        <td>MoM: </td>
                                                                        <td><input type="number" id="mom-1" value="1.5" min="1" class="mom-input"></td>
                                                                        <!-- </tr>
                                  <tr> -->
                                                                        <td>IRR: </td>
                                                                        <td><span id="irr4-1"></span> %</td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        <div class="row">
                                                            <figure>
                                                                <div id="container-4-1"></div>
                                                            </figure>
                                                            <div class="row">
                                                                <div class="col">
                                                                    <input type="range" class="form-range inflow" min="1" max="15" step="1" id="inflow-4-1" value="8">
                                                                </div>
                                                                <div class="col">
                                                                    <input type="range" class="form-range outflow" min="1" max="15" step="1" id="outflow-4-1" value="8">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <hr>
                                                    <div class="row">
                                                        <p><b>Project 2</b></p>
                                                        <div class="row">
                                                            <table class="table table-mom">
                                                                <tbody>
                                                                    <tr>
                                                                        <td>MoM: </td>
                                                                        <td><input type="number" id="mom-2" value="1.5" min="1" class="mom-input"></td>
                                                                        <!-- </tr>
                                  <tr> -->
                                                                        <td>IRR: </td>
                                                                        <td><span id="irr4-2"></span> %</td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        <div class="row">
                                                            <figure>
                                                                <div id="container-4-2"></div>
                                                            </figure>
                                                            <div class="row">
                                                                <div class="col">
                                                                    <input type="range" class="form-range inflow" min="1" max="15" step="1" id="inflow-4-2" value="8">
                                                                </div>
                                                                <div class="col">
                                                                    <input type="range" class="form-range outflow" min="1" max="15" step="1" id="outflow-4-2" value="8">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <hr>
                                                    <div class="row">
                                                        <p><b>Project 3</b></p>
                                                        <div class="row">
                                                            <br><br>
                                                            <table class="table table-mom">
                                                                <tbody>
                                                                    <tr>
                                                                        <td>MoM: </td>
                                                                        <td><input type="number" id="mom-3" value="0.9" class="mom-input" disabled style="color: white;"></td>
                                                                        <!-- </tr>
                                  <tr> -->
                                                                        <td>IRR: </td>
                                                                        <td><span id="irr4-3"></span> %</td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        <div class="row">
                                                            <figure>
                                                                <div id="container-4-3"></div>
                                                            </figure>
                                                            <div class="row">
                                                                <div class="col">
                                                                    <input type="range" class="form-range inflow" min="1" max="15" step="1" id="inflow-4-3" value="15">
                                                                </div>
                                                                <div class="col">
                                                                    <input type="range" class="form-range outflow" min="1" max="15" step="1" id="outflow-4-3" value="1">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- <div style="position:absolute">
                      <i class="bi bi-chevron-double-right"></i>
                    </div> -->
                                        <div class="col-6">
                                            <div class="card" id="" style="height: 100%;">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <h5><b><svg class="title-mark"></svg>Aggregated Cash Flows</b>
                                                        </h5>
                                                    </div>
                                                    <br><br>
                                                    <div class="row">
                                                        <!-- <div class="col-5"> -->
                                                        <table class="table table-aggregated">
                                                            <tbody>
                                                                <tr>
                                                                    <td>Aggregated CFs IRR: </td>
                                                                    <td><span id="irr4"></span> %</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>Average IRR: </td>
                                                                    <td><span id="irr-aver"></span> %</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        <!-- </div> -->
                                                        <!-- <div class="col-7"> -->
                                                        <p><i class="bi bi-info-circle-fill"></i> <i style="font-size: 0.8rem;">IRRs cannot be
                                                                averaged : Aggregated CFs ≠
                                                                IRR Average IRR</i>
                                                        </p>
                                                        <!-- </div> -->
                                                    </div>
                                                    <div class="row">
                                                        <figure>
                                                            <div id="container-4"></div>
                                                        </figure>
                                                    </div>
                                                    <br><br><br>
                                                    <br><br><br>
                                                    <div class="row">
                                                        <ul>
                                                            <p><b>IRR for a portfolio that includes several projects, is calculated with aggregated
                                                                    cash flows for each project.</b> </p>
                                                            <div class="formular" style="font-size: 0.8rem;">
                                                                \(\mathbf{NPV = 0 =
                                                                \mathrm{CF}_{0}^{P1} + \mathrm{CF}_{0}^{P2} + \mathrm{CF}_{0}^{P3} +
                                                                \frac{\mathrm{CF}_{1}^{P1} + \mathrm{CF}_{1}^{P2} + \mathrm{CF}_{1}^{P3}}{(1+IRR)^{1}} +
                                                                \frac{\mathrm{CF}_{2}^{P1} + \mathrm{CF}_{2}^{P2} + \mathrm{CF}_{2}^{P3}}{(1+IRR)^{2}}}\)
                                                                <br>
                                                                <br>
                                                                \(\mathbf{ +
                                                                ... +
                                                                \frac{\mathrm{CF}_{N}^{P1} + \mathrm{CF}_{N}^{P2} + \mathrm{CF}_{N}^{P3}}{(1+IRR)^{N}} =
                                                                \sum_{T=0}^{N}\sum_{T=0}^{N}\frac{\mathrm{CF}_{T}^{P}}{(1+IRR)^{T}}}\)
                                                            </div>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</body>

<script>

    var Formulas = {
        DaysBetween: function (date1, date2) {
            var oneDay = 24 * 60 * 60 * 1000;
            return Math.round(Math.abs((date1.getTime() - date2.getTime()) / oneDay)); // The getTime() method returns the number of milliseconds since the Unix Epoch.
        },
        XNPV: function (rate, values) {
            var xnpv = 0.0;
            var firstDate = new Date(values[0].Date);
            for (var key in values) {
                var tmp = values[key];
                var value = tmp.Flow;
                var date = new Date(tmp.Date);
                xnpv += value / Math.pow(1 + rate, this.DaysBetween(firstDate, date) / 365);
            };
            return xnpv;
        },
        XIRR: function (values, guess) {
            if (!guess) guess = 0.001;

            var x1 = 0.0;
            var x2 = guess;
            var f1 = this.XNPV(x1, values);
            var f2 = this.XNPV(x2, values);

            for (var i = 0; i < 100000; i++) { // initial : 100
                if ((f1 * f2) < 0.0) break; // si f1 ou f2 est négatif mais pas les deux, on sort de la boucle for
                if (Math.abs(f1) < Math.abs(f2)) { // si f1 et f2 ont le même signe et f1 est plus proche de 0
                    f1 = this.XNPV(x1 += 0.001 * (x1 - x2), values); // on calcule la nouvelle present value ; initial : 1.6
                } else {
                    f2 = this.XNPV(x2 += 0.001 * (x2 - x1), values); // initial : 1.6
                }
            };

            if ((f1 * f2) > 0.0) return null;

            var f = this.XNPV(x1, values);
            if (f < 0.0) {
                var rtb = x1;
                var dx = x2 - x1;
            } else {
                var rtb = x2;
                var dx = x1 - x2;
            };

            for (var i = 0; i < 100000; i++) { // initial : 100
                dx *= 0.5;
                var x_mid = rtb + dx;
                var f_mid = this.XNPV(x_mid, values);
                if (f_mid <= 0.0) rtb = x_mid;
                if ((Math.abs(f_mid) < 1.0e-6) || (Math.abs(dx) < 1.0e-6)) return x_mid;
            };

            return null;
        }
    }

    function updateChart(height, width, container, arrCF, sumCashFlows) {

        const caArr = [0, ...arrCF]
        const sumArr = [0, ...sumCashFlows]
        let colorSet = []

        Highcharts.chart(container, {
            chart: {
                height: height,
                width: width,
                zoomType: 'xy',
            },
            title: {
                text: '',
            },
            xAxis: {
                labels: {
                    step: 1
                }
            },
            yAxis: [{ // Primary yAxis
                title: {
                    text: '',
                },
                labels: {
                    enabled: false
                },
                opposite: true,
                min: -100,
                max: 150,
                tickInterval: 50

            }, { // Secondary yAxis
                gridLineWidth: 0,
                title: {
                    text: '',
                    style: {
                        color: Highcharts.getOptions().colors[0]
                    }
                },
                labels: {
                    enabled: false
                },
                plotLines: [{
                    color: '#333F50',
                    width: 1,
                    value: 0
                }]
            }, { // Tertiary yAxis
                gridLineWidth: 0,
                title: {
                    text: '',
                    style: {
                        color: Highcharts.getOptions().colors[1]
                    }
                },
                labels: {
                    enabled: false
                },
                opposite: true,

            }],
            tooltip: {
                shared: true
            },
            plotOptions: {
                series: {
                    dataLabels: {
                        enabled: true,
                        format: '{point.y:,.1f}'
                    },
                    pointWidth: 20
                },

            },
            legend: {
                enabled: false,
                layout: 'vertical',
                align: 'left',
                x: -10,
                verticalAlign: 'top',
                y: 55,
                floating: true,
                backgroundColor:
                    Highcharts.defaultOptions.legend.backgroundColor || // theme
                    'rgba(255,255,255,0.25)'
            },
            series: [{
                name: 'Cash Flow',
                type: 'column',
                color: '#578537',
                negativeColor: '#C00000',
                yAxis: 1,
                data: caArr,
                tooltip: {
                    valueSuffix: ' M€',
                    valueDecimals: 2,
                },
                backgroundColor: '#ffffff',
                animation: false
            }, {
                name: 'Cumulative Cash Flow',
                type: 'spline',
                color: '#AE7451',
                yAxis: 1,
                data: sumArr,
                marker: {
                    enabled: false
                },
                label: {
                    onArea: true
                },
                tooltip: {
                    valueSuffix: ' M€',
                    valueDecimals: 2,
                },
                dataLabels: {
                    enabled: false
                },
                animation: false,
            }],
            credits: {
                enabled: false
            },
        });

    }

    const budgetElem = document.getElementById("budget")
    const totalInflowsElem = document.getElementById("totalInflows")
    const totalOutlowsElem = document.getElementById("totalOutlows")
    const multiplicatorElem = document.getElementById("multiplicator")
    const tableInvestElem = document.getElementById("investTable1")
    const inflowsInputElem = document.getElementById("inflowsInput")

    const tabHorizon = document.getElementById("nav-invest-horizon-tab")
    const tabCashflow = document.getElementById("nav-cash-flow-tab")
    const tabPerf = document.getElementById("nav-performance-tab")
    const tabPortfolio = document.getElementById("nav-portfolio-tab")
    const btnNext1 = document.getElementById("btn-next1")
    const btnNext2 = document.getElementById("btn-next2")
    const btnNext3 = document.getElementById("btn-next3")
    const btnNext4 = document.getElementById("btn-next4")

    const questionNext = document.getElementById("question-next")
    const irrExplanation = document.getElementById("irr-explanation")

    const btnShow = document.getElementById("show-analysis")
    const performanceElem = document.getElementById("performance-analysis")
    const resultTable = document.getElementById("result-table1")

    let budget = 100//budgetElem.value
    let numOfInflows = 4//Number(horizonElem.value)
    let multip = 1.5

    let totalInflow = budget
    let totalOutflow = budget * multip

    reloadInflowsInput(numOfInflows, budget)

    function createCashFlowTable(cashflows) {
        const cfArr = [0, ...cashflows]
        let flowsValue = '<td> Cash Flow</td>', time = ' <td>Time</td>'
        cfArr.forEach((value, i) => {
            time += `<td>${i}</td> `
            flowsValue += `<td>${value}</td>`
        })
        return (`
    <tbody>
    <tr >
    ${time}
    </tr>
    <tr >
    ${flowsValue}
    </tr>
  </tbody>
    `)
    }
    function setValuesforCalcul(cashFlows) {
        cashFlows.unshift(0)
        const nbOfYears = cashFlows.length
        var values = {}
        for (let i = 0; i < nbOfYears; i++) {
            let newYear = new Date()
            // utilisation de dates précises pour la formule xirr - il est préférable d'ajouter +365 pour éviter les années bis et appliquer le calcul exactement comme =irr() dans excel
            // newYear.setFullYear(newYear.getFullYear() + i)
            newYear.setDate(newYear.getDate() + 365 * i)
            values[i] = new Object()
            values[i].Date = newYear
            values[i].Flow = cashFlows[i]
        }
        return values
    }
    function calculateIRR(arrCF) {
        let newArrCF = []
        arrCF.forEach(function (item) {
            newArrCF.push(item)
        })
        valuesForCalculs = setValuesforCalcul(newArrCF)

        let irr = (Math.round(Formulas.XIRR(valuesForCalculs) * 10000) / 100).toString()
        return irr
    }

    function createResultTable(arrCF) {
        let irr = calculateIRR(arrCF)

        let totalInflow = 0
        let totalOutflow = 0
        let roi = ''
        arrCF.forEach((value, i) => {
            const len = arrCF.length
            if (value < 0) {
                totalInflow += value
            } else {
                totalOutflow += value
            }
        })
        const multip = Math.abs(totalOutflow / totalInflow).toFixed(1)

        totalInflow = (-totalInflow).toFixed(0)
        totalOutflow = totalOutflow.toFixed(0)
        roi = ((totalOutflow / totalInflow) - 1) * 100
        roi = roi.toFixed(2)
        return (`
    <tbody>
      <tr>
        <th>Total Capital Calls</th>
        <th>Total Distribution</th>
        <th data-bs-toggle="tooltip" data-bs-placement="top"
          title="Multiple of Money invested">MoM</th>
        <th>IRR</th>
        <th>ROI</th>
      </tr>
      <tr>
        <td>${totalInflow} M€</td>
        <td>${totalOutflow} M€</td>
        <td>${multip}</td>
        <td>${irr}%</td>
        <td>${roi}%</td>
      </tr>
    </tbody>
    `)
    }

    function sumCashFlowsFun(arr) {
        let sumCashFlows = []
        let lastAmount = 0
        arr.forEach((item, i) => {
            sumCashFlows.push(item + lastAmount)
            lastAmount += item
        })
        return sumCashFlows
    }

    function reloadInflowsInput(num, budget) {
        let inflows = []
        let outflows = []
        for (const [i, e] of new Array(num).entries()) {
            const inflow = parseFloat((-budget / num).toFixed(2))
            const outflow = parseFloat((-inflow * multip).toFixed(2))
            inflows.push(inflow)
            outflows.push(outflow)
        }
        const arrCF = [...inflows, ...outflows]
        const years = []
        arrCF.forEach((item, i) => {
            years.push(i + 1)
        })


        let sumCashFlows = sumCashFlowsFun(arrCF)

        return {
            arrCF: arrCF,
            years: years,
            sumCashFlows: sumCashFlows
        }
    }

    const resultValue = reloadInflowsInput(numOfInflows, budget)
    const arrCF = resultValue.arrCF
    const years = resultValue.years
    const sumCashFlows = resultValue.sumCashFlows

    updateChart(null, null, 'container', arrCF, sumCashFlows)

    tableInvestElem.innerHTML = createCashFlowTable(arrCF)

    resultTable.innerHTML = createResultTable(arrCF)

    const equation = document.getElementById('equation-values')

    let sumEquation = ''
    const irr = calculateIRR(arrCF)
    arrCF.forEach(function (item, index) {
        (index > 0) ? sumEquation += "+" : sumEquation
        sumEquation += `\\frac{${item}}{(1+\\mathbf{${irr}\\%})^{${index}}}`
    })
    equation.innerHTML = "\\(NPV = 0 =" + sumEquation + "\\)"

    btnShow.addEventListener('click', e => {
        performanceElem.classList.remove('d-none')
        questionNext.classList.remove('d-none')
        irrExplanation.classList.remove('d-none')
        e.target.classList.add("d-none")
        window.scrollTo(performanceElem.offsetLeft, performanceElem.offsetTop)
    })

    btnNext1.addEventListener('click', (e) => {
        tabHorizon.click()
    })
    btnNext2.addEventListener('click', (e) => {
        tabCashflow.click()
    })
    btnNext3.addEventListener('click', (e) => {
        tabPerf.click()
    })
    btnNext4.addEventListener('click', (e) => {
        tabPortfolio.click()
    })

    renderMathInElement(document.body);

    //horizon
    const tableInvestElem2 = document.getElementById("investTable2")
    const optionsNumOfInflows = document.querySelectorAll('input[name="options"]')
    const resultTable2 = document.getElementById("result-table2")
    const horizonElem = document.getElementById("years")
    const showYearsElem = document.getElementById("show-years")
    const irrElem1 = document.getElementById("irr1")

    displayHorizon(4)
    horizonElem.addEventListener("input", e => {
        const num = Number(e.target.value) / 2
        showYearsElem.innerText = e.target.value
        displayHorizon(num)
    })

    function displayHorizon(num) {
        const resultValue = reloadInflowsInput(num, budget)
        const arrCF = resultValue.arrCF
        const sumCashFlows = resultValue.sumCashFlows
        updateChart(null, null, 'container2', arrCF, sumCashFlows)
        tableInvestElem2.innerHTML = createCashFlowTable(arrCF)
        resultTable2.innerHTML = createResultTable(arrCF)
        irrElem1.innerText = calculateIRR(arrCF)
    }

    //CASH FLOW
    const tableInvestElem3 = document.getElementById("investTable3")
    const resultTable3 = document.getElementById("result-table3")
    const inflowCursor = document.getElementById("inflow")
    const outflowCursor = document.getElementById("outflow")
    const irrElem2 = document.getElementById("irr2")
    const weights = {
        1: [100, 0, 0, 0],
        2: [85, 8, 5, 2],
        3: [72, 13, 10, 5],
        4: [60, 18, 15, 7],
        5: [50, 21, 19, 10],
        6: [41, 23, 22, 14],
        7: [33, 24, 24, 19],
        8: [25, 25, 25, 25],
        9: [19, 24, 24, 33],
        10: [14, 22, 23, 41],
        11: [10, 19, 21, 50],
        12: [7, 15, 18, 60],
        13: [5, 10, 13, 72],
        14: [3, 5, 8, 85],
        15: [2, 3, 5, 90]
    }


    let inflows = [-25, -25, -25, -25]
    let outflows = [37.5, 37.5, 37.5, 37.5]
    display(inflows, outflows)

    inflowCursor.addEventListener("input", e => {
        const index = Number(e.target.value)
        const inflowWeights = weights[index]
        inflowWeights.forEach((w, i) => {
            inflows[i] = (-w)
        })

        display(inflows, outflows)

    })

    outflowCursor.addEventListener("input", e => {
        const index = Number(e.target.value)
        const outflowWeights = weights[index]
        outflowWeights.forEach((w, i) => {
            outflows[i] = (Number((w * multip).toFixed(2)))
        })

        display(inflows, outflows)
    })
    function display(inflows, outflows) {
        const arrCF = [...inflows, ...outflows]
        const sumCashFlows = sumCashFlowsFun(arrCF)
        updateChart(null, null, 'container3', arrCF, sumCashFlows)

        tableInvestElem3.innerHTML = createCashFlowTable(arrCF)
        resultTable3.innerHTML = createResultTable(arrCF)
        irrElem2.innerText = calculateIRR(arrCF)
    }

    //PERFORMANCE
    const timeHorizon = document.getElementById("time-horizon")
    const tableInvestElem4 = document.getElementById("investTable4")
    const resultTable4 = document.getElementById("result-table4")
    const investYears = document.getElementById("invest-year")
    const irrElem3 = document.getElementById("irr3")
    let numHorizon, cashFlowInput

    function createCashFlowTableInput(num) {
        let flowsValue = '<td> Cash Flow</td>', time = ' <td>Time</td>'
        for (let index = 0; index <= num; index++) {
            time += `<td>${index}</td> `
            if (index == 0) {
                flowsValue += `<td>0</td>`
            } else {
                flowsValue += `<td><input name="cf-input" placeholder="Enter Cash Flow"/></td>`
            }
        }
        return (`
    <tbody>
    <tr >
    ${time}
    </tr>
    <tr >
    ${flowsValue}
    </tr>
  </tbody>
    `)
    }

    timeHorizon.addEventListener('input', e => {
        numHorizon = e.target.value
        cashFlowInput = new Array(numHorizon)
        tableInvestElem4.innerHTML = createCashFlowTableInput(numHorizon)

        const sumCashFlows = sumCashFlowsFun(cashFlowInput)
        updateChart(null, null, 'container4', cashFlowInput, sumCashFlows)
        resultTable4.innerHTML = ''
        irrElem3.innerText = ''

        const allInputs = document.querySelectorAll('input[name=cf-input]')
        allInputs.forEach((input, index) => {
            input.addEventListener('input', event => {
                cashFlowInput[index] = Number(event.target.value)
                const sumCashFlows = sumCashFlowsFun(cashFlowInput)
                updateChart(null, null, 'container4', cashFlowInput, sumCashFlows)
                resultTable4.innerHTML = createResultTable(cashFlowInput)
                irrElem3.innerText = calculateIRR(cashFlowInput)
            })
        })
    })

</script>
<script>
    let inflows1 = [-25, -25, -25, -25]
    let outflows1 = inflows1.map(e => e * -1.5)
    let arrCF1 = [...inflows1, ...outflows1]
    let sumCashFlows1 = sumCashFlowsFun(arrCF1)
    let inflows2 = [-20, -20, -20, -20, -20]
    let outflows2 = inflows2.map(e => e * -1.5)
    let arrCF2 = [...inflows2, ...outflows2]
    let sumCashFlows2 = sumCashFlowsFun(arrCF2)
    let inflows3 = [-1, -1, -2, -3, -3, -90]
    let outflows3 = [90, 0, 0, 0, 0, 0]
    // let outflows3 = inflows3.map(e => e * -0.9)
    let arrCF3 = [...inflows3, ...outflows3]
    let sumCashFlows3 = sumCashFlowsFun(arrCF3)
    const weights5 = {
        1: [100, 0, 0, 0, 0],
        2: [83, 8, 5, 3, 1],
        3: [68, 12, 9, 7, 4],
        4: [55, 15, 12, 10, 8],
        5: [44, 17, 15, 13, 11],
        6: [35, 18, 17, 16, 14],
        7: [27, 19, 19, 18, 17],
        8: [20, 20, 20, 20, 20],
        9: [15, 19, 19, 18, 17],
        10: [11, 17, 17, 19, 36],
        11: [8, 14, 15, 18, 45],
        12: [6, 11, 12, 16, 55],
        13: [4, 7, 9, 14, 66],
        14: [3, 4, 6, 9, 78],
        15: [1, 2, 3, 3, 91]
    }
    const weights6 = {
        1: [100, 0, 0, 0, 0, 0],
        2: [83, 7, 4, 3, 2, 1],
        3: [68, 8.5, 7.5, 7, 6, 3],
        4: [55, 11, 10, 9, 8, 7],
        5: [44, 12, 12, 11, 11, 10],
        6: [34, 15, 14, 13, 12, 12],
        7: [25, 16, 16, 15, 14, 14],
        8: [16.6666, 16.6666, 16.6666, 16.6666, 16.6666, 16.6666],
        9: [12.6666, 16, 16, 16, 16.6666, 22.6666],
        10: [9.6666, 14, 14.8333, 15.5, 16, 30],
        11: [7.6666, 12.1666, 13.1666, 14, 15, 38],
        12: [5.6666, 9, 11.3333, 12, 14, 48],
        13: [3.6666, 5.3333, 8, 10, 13, 60],
        14: [1.6666, 3.5, 5.5, 7.3333, 8, 74],
        15: [1, 1, 2, 3, 3, 90]
    }


    updateChart(200, null, 'container-4-1', arrCF1, sumCashFlows1)
    updateChart(200, null, 'container-4-2', arrCF2, sumCashFlows2)
    updateChart(200, null, 'container-4-3', arrCF3, sumCashFlows3)
    updateChartCombine(arrCF1, arrCF2, arrCF3)


    const inflowCursor1 = document.getElementById("inflow-4-1")
    const outflowCursor1 = document.getElementById("outflow-4-1")
    const inflowCursor2 = document.getElementById("inflow-4-2")
    const outflowCursor2 = document.getElementById("outflow-4-2")
    const inflowCursor3 = document.getElementById("inflow-4-3")
    const outflowCursor3 = document.getElementById("outflow-4-3")
    const momInputs = document.querySelectorAll('input[class=mom-input]')

    function refreshChartByInflow(index, inflowWeights) {
        let arrCF
        switch (index) {
            case 1:
                inflowWeights.forEach((w, i) => {
                    inflows1[i] = (-w)
                })
                arrCF1 = [...inflows1, ...outflows1]
                arrCF = arrCF1
                break;
            case 2:
                inflowWeights.forEach((w, i) => {
                    inflows2[i] = (-w)
                })
                arrCF2 = [...inflows2, ...outflows2]
                arrCF = arrCF2
                break;
            case 3:
                inflowWeights.forEach((w, i) => {
                    inflows3[i] = (-w)
                })
                arrCF3 = [...inflows3, ...outflows3]
                arrCF = arrCF3
                break;

            default:
                break;
        }
        updateChart(200, null, `container-4-${index}`, arrCF, sumCashFlowsFun(arrCF))
        updateChartCombine(arrCF1, arrCF2, arrCF3)

    }

    function refreshChartByOutflow(index, inflowWeights, multip) {
        let arrCF
        switch (index) {
            case 1:
                inflowWeights.forEach((w, i) => {
                    outflows1[i] = (Number((w * multip).toFixed(2)))
                })
                arrCF1 = [...inflows1, ...outflows1]
                arrCF = arrCF1
                break;
            case 2:
                inflowWeights.forEach((w, i) => {
                    outflows2[i] = (Number((w * multip).toFixed(2)))
                })
                arrCF2 = [...inflows2, ...outflows2]
                arrCF = arrCF2
                break;
            case 3:
                inflowWeights.forEach((w, i) => {
                    outflows3[i] = (Number((w * multip).toFixed(2)))
                })
                arrCF3 = [...inflows3, ...outflows3]
                arrCF = arrCF3
                break;

            default:
                break;
        }
        updateChart(200, null, `container-4-${index}`, arrCF, sumCashFlowsFun(arrCF))
        updateChartCombine(arrCF1, arrCF2, arrCF3)
    }

    inflowCursor1.addEventListener("input", e => {
        const index = Number(e.target.value)
        const inflowWeights = weights[index]
        refreshChartByInflow(1, inflowWeights)
    })
    outflowCursor1.addEventListener("input", e => {
        const index = Number(e.target.value)
        const inflowWeights = weights[index]
        const multip1 = parseFloat(document.getElementById('mom-1').value)
        refreshChartByOutflow(1, inflowWeights, multip1)
    })

    inflowCursor2.addEventListener("input", e => {
        const index = Number(e.target.value)
        const inflowWeights = weights5[index]
        refreshChartByInflow(2, inflowWeights)
    })
    outflowCursor2.addEventListener("input", e => {
        const index = Number(e.target.value)
        const inflowWeights = weights5[index]
        const multip2 = parseFloat(document.getElementById('mom-2').value)
        refreshChartByOutflow(2, inflowWeights, multip2)
    })

    inflowCursor3.addEventListener("input", e => {
        const index = Number(e.target.value)
        const inflowWeights = weights6[index]
        refreshChartByInflow(3, inflowWeights)
    })
    outflowCursor3.addEventListener("input", e => {
        const index = Number(e.target.value)
        const inflowWeights = weights6[index]
        const multip3 = parseFloat(document.getElementById('mom-3').value)
        refreshChartByOutflow(3, inflowWeights, multip3)
    });
    momInputs.forEach(input => {
        input.addEventListener('input', (e) => {
            if (e.target.value < 1)
                e.target.value = 1
            const index = Number(e.target.id.split('-')[1])
            const outflowCursorIndex = Number(document.getElementById(`outflow-4-${index}`).value)
            let inflowWeights, sumFlows
            if (index == 1) {
                inflowWeights = weights[outflowCursorIndex]
                sumFlows = arrCF1
            }
            if (index == 2) {
                inflowWeights = weights5[outflowCursorIndex]
                sumFlows = arrCF2
            }
            if (index == 3) {
                inflowWeights = weights6[outflowCursorIndex]
                sumFlows = arrCF3
            }
            const multip = parseFloat(document.getElementById(`mom-${index}`).value)
            refreshChartByOutflow(index, inflowWeights, multip)
        })
    })

    function updateChartCombine(arrCF1, arrCF2, arrCF3) {
        const sum = (...arrays) => arrays
            .sort((a, b) => b.length - a.length)
            .reduce((a, c) => a.map((n, i) => n + (c[i] || 0)) || c)

        const sumFlows = sum(arrCF1, arrCF2, arrCF3)
        const sumCF = sumCashFlowsFun(sumFlows)
        const irr = calculateIRR(sumFlows)
        const irr1 = calculateIRR(arrCF1)
        const irr2 = calculateIRR(arrCF2)
        const irr3 = calculateIRR(arrCF3)
        const irrAver = [irr1, irr2, irr3].reduce((a, b) => parseFloat(a) + parseFloat(b), 0) / 3;

        updateChart(500, null, 'container-4', sumFlows, sumCF)
        document.getElementById('irr4').innerText = irr
        document.getElementById(`irr4-1`).innerText = irr1
        document.getElementById(`irr4-2`).innerText = irr2
        document.getElementById(`irr4-3`).innerText = irr3
        document.getElementById(`irr-aver`).innerText = irrAver.toFixed(2)
    }

    const CF = (num) => `\\mathrm{CF}_{${num}}^{p1} + \\mathrm{CF}_{${num}}^{p2} + \\mathrm{CF}_{${num}}^{p3}`
    const CF1 = (num) => `\\frac{${CF(num)}}{(1 + IRR)^{${num}}}`
    const SUM = CF(0) + ' + ' + CF1(1) + ' + ' + CF1(2) + ' + ' + ' ... ' + + CF1('N')
    // document.getElementById('formular_4').innerHTML = "\\(NPV = 0 =" + SUM + "\\)"

</script>

</html>